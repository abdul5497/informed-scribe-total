{% extends 'web/app/app_base.html' %}
{% block app %}
{% load static %}
<section class="app-card">
  <h1>Informed CareGuide</h1>
  <div class="bubble_page">
    <div class="left-section">

      <div class="option-section1">
        <form id="uploadForm" enctype="multipart/form-data">
          {% csrf_token %}
          <input type="file" name="file" required accept=".txt, .pdf, .doc, .docx, .csv">
          <button type="button" id="uploadButton" class="bubble_button_element">Upload</button>
        </form>
      </div>

      <div class="audio-section">
        <div id="error" class="isa_error"></div>
        <div class="bubble-element-group">
          <textarea class="result-section" id="result-textarea">
            </textarea>
          <div class="loading-div">
            <span id="loading-icon" class="loading-icon"></span>
          </div>
          <div class="font_button_style">
            <button class="font_bigger_style" id="result-section-font-big">A</button>
            <button class="font_smaller_style" id="result-section-font-small">A</button>
          </div>
        </div>

        <textarea class="bubble_medical_textarea_element" id="transcript" placeholder="e.g. 'How can I treat my hurt?'">
        </textarea>
      </div>

    </div>
    <div class="right-section">
      <div class="option-section">
        <textarea id="addionalNotes" name="addionalNotes" class="type-section" rows="5" cols="50"></textarea>

        <div class="font_button_style">
          <button class="font_bigger_style" id="addionalNotes-font-big">A</button>
          <button class="font_smaller_style" id="addionalNotes-font-small">A</button>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block page_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    $('#uploadButton').click(function() {
      console.log("uploadButton clicked");

      var form = $('#uploadForm')[0];
      var formData = new FormData(form);

      $.ajax({
        url: '/openai/upload_file',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(data) {
          // Handle the response data
          console.log('Status:', data.status);
          console.log('File URL:', data.file_url);
          // You can perform further actions based on the response, such as displaying a success message or redirecting the user
        },
        error: function(xhr, status, error) {
          console.error('Error:', error);
          // Handle the error, e.g., display an error message to the user
        }
      });
    });
  });
</script>
{% endblock %}